!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.jFactory=e()}(this,function(){"use strict";function t(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(){i(this,t),this._events={}}return t.prototype.on=function(t,e){var i=this._events[t]||(this._events[t]=[]);return i.push(e),this},t.prototype.off=function(t,e){var i=this;if("string"==typeof t&&this._events[t])if(e){var n=this._events[t];n.indexOf(e)!==-1&&n.splice(n.indexOf(e),1)}else this._events[t]=null;else"function"==typeof t&&(e=t,Object.keys(this._events).forEach(function(t){var n=i._events[t];n.indexOf(e)!==-1&&n.splice(n.indexOf(e),1)}));return this},t.prototype.trigger=function(t){for(var e=this,i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];var s=this._events[t];return s&&s.forEach(function(t){return t.apply(e,n)}),this},t.prototype.destroy=function(){delete this._events},t}(),s=function(o){function s(e,n,r,h){i(this,s);var a=t(this,o.call(this));return a.name=e,a.data=r,a.config=n,a.history=[],setTimeout(function(){a.next()},0),a}return e(s,o),s.prototype.update=function(t){var e=this.data;"undefined"!=typeof t&&t!==e&&(this.data=t,this.trigger(this.constructor.EVENTS.DATA_UPDATE,e,t))},s.prototype.getJob=function(t){var e;if("number"==typeof t?e=t:"string"==typeof t?e=this.config.findIndex(function(e){return e===t||e.name===t}):"function"==typeof t&&(e=this.config.findIndex(function(e){return t(e)})),e>=0)return{config:this.config[e],index:e}},s.prototype.go=function(t,e){if(void 0!==t){var i=this.getJob(t),n=i.index;if(i=i.config,!i)throw new Error("get job error: on "+t+"; no this target");var o,s;if("function"==typeof i)s=i;else{if("function"!=typeof i.main)throw new Error("get job error: on "+t+"; job or job.main must is function");s=i.main}o=Object.assign({notHistory:!1},i.options,e),this.trigger(this.constructor.EVENTS.JOB_BEFORE_ACTION,this.data),o.notHistory||(this.history.splice(this.history.step,this.history.length-this.history.step,n),this.history.step=this.history.length),this.step=n;var r=s(this.data,this);this.trigger(this.constructor.EVENTS.JOB_ACTION,this.data),"function"==typeof r?r(this):this.next(r)}},s.prototype.next=function(t){t&&this.update(t);var e;if(void 0===this.step)e=0;else{if(this.step>=this.config.length-1)return this.complete(),!1;e=this.step+1}this.go(e)},s.prototype.previous=function(t){t&&this.update(t);var e;e=void 0===this.step?0:this.step-1,this.go(e)},s.prototype.back=function(t){t&&this.update(t);var e;this.history.length&&this.history.step>0&&(this.history.step--,e=this.history[this.history.step-1],this.go(e,{notHistory:!0}))},s.prototype.forward=function(t){t&&this.update(t);var e;this.history.length&&this.history.step<this.history.length&&(this.history.step++,e=this.history[this.history.step+1],this.go(e,{notHistory:!0}))},s.prototype.cancel=function(t){t&&this.update(t),this.trigger(this.constructor.EVENTS.CANCEL,this.data),this.destroy()},s.prototype.complete=function(t){t&&this.update(t),this.trigger(this.constructor.EVENTS.COMPLETE,this.data),this.destroy()},s.prototype.destroy=function(){"function"==typeof this.constructor.destroy&&this.constructor.destroy(),delete this.options,delete this.data,delete this.config,delete this.history},n(s,null,[{key:"EVENTS",get:function(){return{COMPLETE:"complete",CANCEL:"cancel",JOB_BEFORE_ACTION:"beforeActive",JOB_ACTION:"active",DATA_UPDATE:"update"}}}]),s}(o),r=function(){function t(e){i(this,t),this.reset(e)}return t.prototype.reset=function(t){t=Object.assign({},t),this._tasks=Object.assign({},t.tasks),this._jobs=Object.assign({},t.jobs)},t.prototype.add=function(t){Object.assign(this._tasks,t.tasks),Object.assign(this._jobs,t.jobs)},t.prototype.addJobs=function(t){this.add({jobs:t})},t.prototype.addTasks=function(t){this.add({tasks:t})},t.prototype.createTaskArray=function(t){var e=this;return t.map(function(t){if("string"==typeof t&&e._jobs[t])return{name:t,main:e._jobs[t]};if("function"==typeof t)return t;if(t.main){if("string"==typeof t.main&&e._jobs[t.main])return Object.assign({},t,{main:e._jobs[t.main]});if("function"==typeof t.main)return Object.assign({},t)}}).filter(function(t){return t})},t.prototype.createTask=function(t,e){var i,n,o;if(!t)throw new Error("taskName is necessary");if("string"==typeof t&&this._tasks[t])i=t,n=this._tasks[t];else if("string"==typeof t.main&&this._tasks[t.main])i=t.main,n=this._tasks[t],o=t.options;else if(Array.isArray(t))n=t;else{if(!Array.isArray(t.main))throw new Error(t.toString()+" is not set");n=t.main,o=t.options}return n=this.createTaskArray(n),new s(i,n,e,o)},t}(),h=r;return h});